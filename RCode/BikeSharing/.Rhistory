plot_data<-bikesharing %>% pivot_longer(cols =c(registered,casual),names_to="RideType",values_to="NumberOfRides") %>%
select(season,RideType,NumberOfRides) %>% mutate(season=factor(season,levels=c("winter","spring","summer","fall"))
,RideType=factor(RideType,levels=c("registered","casual"))
)
plot_data<-bikesharing %>% pivot_longer(cols =c(registered,casual),names_to="RideType",values_to="NumberOfRides") %>%
select(season,RideType,NumberOfRides) %>% mutate(season=factor(season,levels=c("winter","spring","summer","fall"))
,RideType=factor(RideType,levels=c("registered","casual"))
)
ggplot(data = plot_data) +
geom_col(mapping = aes(x=hr,y=NumberOfRides),fill="lightblue")+
scale_x_discrete(name="hour", breaks=seq(0,23))+
facet_grid(rows = vars(season),cols = vars(RideType),switch = "y") +
theme_classic()
plot_data<-bikesharing %>% pivot_longer(cols =c(registered,casual),names_to="RideType",values_to="NumberOfRides") %>%
select(weekday,season,RideType,NumberOfRides) %>% mutate(season=factor(season,levels=c("winter","spring","summer","fall"))
,RideType=factor(RideType,levels=c("registered","casual"))
)
plot_data
plot_data<-bikesharing %>% pivot_longer(cols =c(registered,casual),names_to="RideType",values_to="NumberOfRides") %>%
select(weekday,season,RideType,NumberOfRides) %>% mutate(season=factor(season,levels=c("winter","spring","summer","fall"))
,RideType=factor(RideType,levels=c("registered","casual")
,weekday=factor(weekday,levels = c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"))
plot_data<-bikesharing %>% pivot_longer(cols =c(registered,casual),names_to="RideType",values_to="NumberOfRides") %>%
select(weekday,season,RideType,NumberOfRides) %>% mutate(season=factor(season,levels=c("winter","spring","summer","fall"))
,RideType=factor(RideType,levels=c("registered","casual")
,weekday=factor(weekday,levels = c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"))
)
plot_data<-bikesharing %>% pivot_longer(cols =c(registered,casual),names_to="RideType",values_to="NumberOfRides") %>%
select(weekday,season,RideType,NumberOfRides) %>% mutate(season=factor(season,levels=c("winter","spring","summer","fall"))
,RideType=factor(RideType,levels=c("registered","casual")
,weekday=factor(weekday,levels = c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"))
)
)
bikesharing
plot_data<-bikesharing %>% pivot_longer(cols =c(registered,casual),names_to="RideType",values_to="NumberOfRides") %>%
select(weekday,season,RideType,NumberOfRides) %>% mutate(season=factor(season,levels=c("winter","spring","summer","fall"))
,RideType=factor(RideType,levels=c("registered","casual")
,weekday=factor(weekday,levels = c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"))
)
)
plot_data<-bikesharing %>% pivot_longer(cols =c(registered,casual),names_to="RideType",values_to="NumberOfRides") %>%
select(weekday,season,RideType,NumberOfRides) %>% mutate(season=factor(season,levels=c("winter","spring","summer","fall"))
,RideType=factor(RideType,levels=c("registered","casual"))
,weekday=factor(weekday,levels = c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"))
)
plot_data
ggplot(data = plot_data) +
geom_col(mapping = aes(x=weekday,y=NumberOfRides),fill="lightblue") +
facet_grid(rows = vars(season),cols = vars(RideType)) +
theme_classic()
ggplot(data = plot_data) +
geom_col(mapping = aes(x=weekday,y=NumberOfRides),fill="lightblue") +
facet_grid(rows = vars(season),cols = vars(RideType)) +
scale_y_continuous(labels=function(n){format(n, scientific = FALSE)})+
theme_classic()
plot_data <- bikesharing %>% group_by(weekday,season) %>%
summarise(registered=mean(registered),casual=mean(casual)) %>%
pivot_longer(cols = c(registered,casual),names_to="RideType",values_to="AverageRides") %>%
mutate(season=factor(season,levels=c("winter","spring","summer","fall"))
,RideType=factor(RideType,levels=c("registered","casual"))
,weekday=factor(weekday,levels = c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"))
)
plot_data
ggplot(data = plot_data) +
geom_col(mapping = aes(x=weekday,y=AverageRides),fill="lightblue") +
facet_grid(rows = vars(season),cols = vars(RideType)) +
theme_classic()
rm(list=c("plot_data_1","plot_data_2"))
plot_data<- bikesharing %>% select(dteday,registered,casual) %>%
group_by(dteday) %>% summarise(registered=sum(registered),casual=sum(casual)) %>%
pivot_longer(cols=c(registered,casual),names_to="RideType",values_to="NumberOfRides")
fig<-ggplot(data = plot_data) +
geom_line(mapping = aes(x=dteday,y=NumberOfRides,color=RideType))+
theme_classic()+
theme(
legend.position = c(1, 1),
legend.justification = c("right", "top"),
legend.box.just = "right",
legend.margin = margin(0, 0, 0, 0)
)
fig
ggsave("./figs/rides_daily.png",plot = fig,device = "png")
rm(plot_data)
windowsize <- 7
plot_data<- bikesharing %>% select(dteday,registered,casual) %>%
group_by(dteday) %>%
summarise(sumreg=sum(registered),sumcas=sum(casual)) %>%
mutate(regrollm=rollmean(x=sumreg,k=windowsize,align="right",fill=NA),
casrollm=rollmean(x=sumcas,k=windowsize,align="right",fill=NA),
regrollsd=rollapplyr(data= sumreg,width=windowsize,FUN="sd",fill=NA),
casrollsd=rollapplyr(data= sumcas,width=windowsize,FUN="sd",fill=NA)
) %>% select(dteday,registered=regrollm,registeredsd=regrollsd,casual=casrollm,casualsd=casrollsd) %>% filter(!is.na(registered))
plot_data_1<- plot_data %>% select(dteday,registered,casual) %>%
pivot_longer(cols = c("registered","casual"),names_to="RideType",values_to="RollingMeanRides")
plot_data_2<- plot_data %>% select(dteday,registeredsd,casualsd) %>%
pivot_longer(cols = c("registeredsd","casualsd"),names_to="RideType",values_to="RollingsdRides")
fig <- ggplot(data = plot_data_1) + geom_line(mapping = aes(x=dteday,y=RollingMeanRides,color=RideType)) +
geom_ribbon(data=plot_data_2,mapping = aes(x=dteday,ymin=plot_data_1$RollingMeanRides-2*RollingsdRides,ymax=plot_data_1$RollingMeanRides+2*RollingsdRides,fill=RideType),alpha=0.25,show.legend = FALSE) +
theme_classic()+
theme(
legend.position = c(1, 1),
legend.justification = c("right", "top"),
legend.box.just = "right",
legend.margin = margin(0, 0, 0, 0)
)
fig
ggsave("./figs/rolling_rides_daily.png",plot = fig,device = "png")
rm(list=c("plot_data_1","plot_data_2"))
?t.test
plot(extra ~ group, data = sleep)
sleep
sleep %>% filter(group==1) %>% summarise(cn=n())
sleep %>% filter(group==1) %>% summarise(cn=n())
sleep %>% filter(group==2) %>% summarise(cn=n())
with(sleep, t.test(extra[group == 1], extra[group == 2]))
t.test(extra ~ group, data = sleep)
t.test(extra ~ 1, data = sleep)
sleep2 <- reshape(sleep, direction = "wide",
idvar = "ID", timevar = "group")
sleep2
bikesharing %>%
select(weekday,registered,casual) %>%
mutate(IsWeekDay=case_when(
weekday %in% c("Saturday","Sunday") ~ TRUE,
TRUE~FALSE
))
bikesharing %>%
select(weekday,registered,casual) %>%
mutate(IsWeekDay=case_when(
weekday %in% c("Saturday","Sunday") ~ FALSE,
TRUE~TRUE
))
bikesharing %>%
select(weekday,registered,casual) %>%
mutate(IsWeekDay=case_when(
weekday %in% c("Saturday","Sunday") ~ FALSE,
TRUE~TRUE
)) %>% filter(!weekday %in%c("Saturday","Sunday") && IsWeekDay==FALSE)
bikesharing %>%
select(weekday,registered,casual) %>%
mutate(IsWeekDay=case_when(
weekday %in% c("Saturday","Sunday") ~ FALSE,
TRUE~TRUE
)) %>% filter(!weekday %in%c("Saturday","Sunday") )
bikesharing %>%
select(weekday,registered,casual) %>%
mutate(IsWeekDay=case_when(
weekday %in% c("Saturday","Sunday") ~ FALSE,
TRUE~TRUE
)) %>%
select(IsWeekDay,casual,registered)
library(broom)
library(tidyverse)
library(broom)
d <- tibble(value = rnorm(100),
category = sample(1:5, replace = TRUE, 100),
group = sample(c('A', 'B'), replace = TRUE, 100)) %>%
arrange(category)
d
d %>%
group_by(category, group) %>%
nest() %>%
spread(key = group, value = data)
bikesharing %>%
select(weekday,registered,casual) %>%
mutate(IsWeekDay=case_when(
weekday %in% c("Saturday","Sunday") ~ FALSE,
TRUE~TRUE
)) %>%
select(IsWeekDay,casual,registered)
ttestData<-bikesharing %>%
select(weekday,registered,casual) %>%
mutate(IsWeekDay=case_when(
weekday %in% c("Saturday","Sunday") ~ FALSE,
TRUE~TRUE
)) %>%
select(IsWeekDay,casual,registered)
ttestData %>% filter(IsWeekDay==TRUE)
ttestData %>% table()
ttestData %>% table(IsWeekDay)
table(ttestData)
table(ttestData$IsWeekDay)
table(ttestData %>% select(IsWeekDay,registered),IsWeekDay )
table(ttestData %>% select(IsWeekDay,registered),ttestData$IsWeekDay )
ttestData %>% select(IsWeekDay,registered)
table(ttestData %>% select(IsWeekDay,registered),(ttestData %>% select(IsWeekDay,registered)$IsWeekDay )
)
t.test(ttestData %>% select(registered) %>% filter(IsWeekDay==TRUE),ttestData %>% select(registered) %>% filter(IsWeekDay==FALSE))
ttestData
tesst1<- t.test(ttestData %>%  filter(IsWeekDay==TRUE) %>% select(registered) ,ttestData %>% filter(IsWeekDay==FALSE %>% select(registered) ))
tesst1<- t.test(ttestData %>%  filter(is(IsWeekDay) %>% select(registered) ,ttestData %>% filter(!is(IsWeekDay) %>% select(registered) ))
tesst1<- t.test(ttestData %>%  filter(is(IsWeekDay) %>% select(registered)),
ttestData %>%  filter(!is(IsWeekDay) %>% select(registered))
)
ttestData %>% filter(IsWeekDay==TRUE)
tesst1<- t.test(ttestData %>%  filter(IsWeekDay==TRUE ) %>% select(registered),
ttestData %>%  filter(IsWeekDay==FALSE) %>% select(registered)
)
tesst1
tesst1<- t.test(ttestData %>%  filter(IsWeekDay==TRUE ) %>% select(registered),
ttestData %>%  filter(IsWeekDay==FALSE) %>% select(registered)
) %>% tidy()
tesst1
t.test(ttestData %>%  filter(IsWeekDay==TRUE ) %>% select(registered),
ttestData %>%  filter(IsWeekDay==FALSE) %>% select(registered)
)
ttestData %>%  filter(IsWeekDay==FALSE) %>% select(registered)
t.test(ttestData %>%  filter(IsWeekDay==TRUE ) %>% select(registered),
ttestData %>%  filter(IsWeekDay==FALSE) %>% select(registered)
)
tesst1<- t.test(ttestData %>%  filter(IsWeekDay==TRUE ) %>% select(registered),
ttestData %>%  filter(IsWeekDay==FALSE) %>% select(registered)
) %>% tidy()
tesst1
tesst1<- t.test(ttestData %>%  filter(IsWeekDay==TRUE ) %>% select(registered),
ttestData %>%  filter(IsWeekDay==FALSE) %>% select(registered),var.equal = FALSE
) %>% tidy()
testt1
tesst1<- t.test(ttestData %>%  filter(IsWeekDay==TRUE ) %>% select(registered),
ttestData %>%  filter(IsWeekDay==FALSE) %>% select(registered),var.equal = FALSE
) %>% tidy()
tesst1
ttestData %>%  filter(IsWeekDay==TRUE ) %>% select(registered) %>% nrow()
tesst1<- t.test(ttestData %>%  filter(IsWeekDay==TRUE ) %>% select(registered),
ttestData %>%  filter(IsWeekDay==FALSE) %>% select(registered),var.equal = FALSE
) %>% tidy()
tesst1
tesst1<- t.test(ttestData %>%  filter(IsWeekDay==TRUE ) %>% select(registered),
ttestData %>%  filter(IsWeekDay==FALSE) %>% select(registered),var.equal = TRUE
) %>% tidy()
tesst1
tesst1<- t.test(ttestData %>%  filter(IsWeekDay==TRUE ) %>% select(registered),
ttestData %>%  filter(IsWeekDay==FALSE) %>% select(registered),var.equal = FALSE
) %>% tidy()
tesst1
tesst1
View(tesst1)
t.test(IsWeekDay~registered,data = ttestData,var.equal=FALSE)
tips
library(tidyr)
tips
library(reshape2)
tips
tips
bikesharing %>%
select(weekday,registered,casual) %>%
mutate(IsWeekDay=case_when(
weekday %in% c("Saturday","Sunday") ~ FALSE,
TRUE~TRUE
)) %>%
select(IsWeekDay,casual,registered) %>%
pivot_longer(cols=c(registered,casual),names_to="RideType",cols_to="NumRides")
-bikesharing %>%
select(weekday,registered,casual) %>%
mutate(IsWeekDay=case_when(
weekday %in% c("Saturday","Sunday") ~ FALSE,
TRUE~TRUE
)) %>%
select(IsWeekDay,casual,registered) %>%
pivot_longer(cols=c(registered,casual),names_to="RideType",values_to="NumRides")
bikesharing %>%
select(weekday,registered,casual) %>%
mutate(IsWeekDay=case_when(
weekday %in% c("Saturday","Sunday") ~ FALSE,
TRUE~TRUE
)) %>%
select(IsWeekDay,casual,registered) %>%
pivot_longer(cols=c(registered,casual),names_to="RideType",values_to="NumRides")
ttestData<-bikesharing %>%
select(weekday,registered,casual) %>%
mutate(IsWeekDay=case_when(
weekday %in% c("Saturday","Sunday") ~ FALSE,
TRUE~TRUE
)) %>%
select(IsWeekDay,casual,registered) %>%
pivot_longer(cols=c(registered,casual),names_to="RideType",values_to="NumRides")
ttestData
ttestData
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest()
library(tidyverse)
library(broom)
set.seed(354654)
d <- tibble(value = rnorm(100),
category = sample(1:5, replace = TRUE, 100),
group = sample(c('A', 'B'), replace = TRUE, 100)) %>%
arrange(category)
d
d %>%
group_by(category, group) %>%
nest()
d %>%
group_by(category, group) %>%
nest() %>%
spread(key = group, value = data)
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest()
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  )
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  ) %>%
t_test = map2(`FALSE`, `TRUE`, ~{t.test(.x$value, .y$value) %>% tidy()})
ttestData<-bikesharing %>%
select(weekday,registered,casual) %>%
mutate(IsWeekDay=case_when(
weekday %in% c("Saturday","Sunday") ~ "No",
TRUE~"Yes"
)) %>%
select(IsWeekDay,casual,registered) %>%
pivot_longer(cols=c(registered,casual),names_to="RideType",values_to="NumRides")
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  )
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  ) %>%
t_test = map2(No, Yes, ~{t.test(.x$value, .y$value) %>% tidy()})
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  ) %>%
mutate(t_test = map2(No, Yes, ~{t.test(.x$value, .y$value) %>% tidy()})
)
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  )
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  ) %>%
mutate(
t_test = map2(No, Yes, ~{t.test(.x$value, .y$value) %>% tidy()})
)
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  )
d %>%
group_by(category, group) %>%
nest() %>%
spread(key = group, value = data)
d <- tibble(value1 = rnorm(100),
category = sample(1:5, replace = TRUE, 100),
group = sample(c('A', 'B'), replace = TRUE, 100)) %>%
arrange(category)
d %>%
group_by(category, group) %>%
nest() %>%
spread(key = group, value = data)
d %>%
group_by(category, group) %>%
nest() %>%
spread(key = group, value = data) %>%
mutate(
t_test = map2(A, B, ~{t.test(.x$value, .y$value) %>% tidy()}),
A = map(A, nrow),
B = map(B, nrow)
) %>%
unnest()
d %>%
group_by(category, group) %>%
nest() %>%
spread(key = group, value = data) %>%
mutate(
t_test = map2(A, B, ~{t.test(.x$value1, .y$value1) %>% tidy()}),
A = map(A, nrow),
B = map(B, nrow)
) %>%
unnest()
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  ) %>%
mutate(
t_test = map2(No, Yes, ~{t.test(.x$NumRides, .y$NumRides) %>% tidy()})
) %>%
unnest()
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  )
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  )
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  ) %>%
mutate(
t_test = map2(No, Yes, ~{t.test(.x$NumRides, .y$NumRides) %>% tidy()})
)
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  ) %>%
mutate(
t_test = map2(No, Yes, ~{t.test(.x$NumRides, .y$NumRides) %>% tidy()})
) %>%
unnest()
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  ) %>%
mutate(
t_test = map2(No, Yes, ~{t.test(.x$NumRides, .y$NumRides) %>% tidy()})
) %>%
unnest(No,Yes,t_test)
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  ) %>%
mutate(
t_test = map2(No, Yes, ~{t.test(.x$NumRides, .y$NumRides) %>% tidy()})
) %>%
unnest(c(No,Yes,t_test))
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  ) %>%
mutate(
t_test = map2(No, Yes, ~{t.test(.x$NumRides, .y$NumRides) %>% tidy()})
)
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  ) %>%
mutate(
t_test = map2(No, Yes, ~{t.test(.x$NumRides, .y$NumRides) %>% tidy()})
) %>%
unnest(c(t_test))
View(
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  ) %>%
mutate(
t_test = map2(No, Yes, ~{t.test(.x$NumRides, .y$NumRides) %>% tidy()})
) %>%
unnest(c(t_test))
)
View(
ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  ) %>%
mutate(
t_test = map2(No, Yes, ~{t.test(.x$NumRides, .y$NumRides) %>% tidy()})
) %>%
unnest(c(t_test))
)
testResults<-ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  ) %>%
mutate(
t_test = map2(No, Yes, ~{t.test(.x$NumRides, .y$NumRides) %>% tidy()})
) %>%
unnest(c(t_test)) %>%
select(RideType,statistic,p.value)
ttestData<-bikesharing %>%
select(weekday,registered,casual) %>%
mutate(IsWeekDay=case_when(
weekday %in% c("Saturday","Sunday") ~ "No",
TRUE~"Yes"
)) %>%
select(IsWeekDay,casual,registered) %>%
pivot_longer(cols=c(registered,casual),names_to="RideType",values_to="NumRides")
testResults<-ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  ) %>%
mutate(
t_test = map2(No, Yes, ~{t.test(.x$NumRides, .y$NumRides) %>% tidy()})
) %>%
unnest(c(t_test)) %>%
select(RideType,statistic,p.value)
testResults
?nest
testResults<-ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
spread(key =IsWeekDay,value =data  ) %>%
mutate(
t_test = map2(No, Yes, ~{t.test(.x$NumRides, .y$NumRides) %>% tidy()})
) %>%
unnest(c(t_test)) %>%
select(RideType,statistic,p.value)
testResults
?spread
testResults<-ttestData %>%
group_by(RideType,IsWeekDay) %>%
nest() %>%
pivot_wider(names_from = IsWeekDay,values_from=data) %>%
mutate(
t_test = map2(No, Yes, ~{t.test(.x$NumRides, .y$NumRides) %>% tidy()})
) %>%
unnest(c(t_test)) %>%
select(RideType,statistic,p.value)
testResults
?t.test
bikesharing %>% group_by(weekday) %>% summarise(TotalRegRides=sum(registered))
bikesharing %>% select(weekday,registered)
